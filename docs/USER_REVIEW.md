# User Review Guide: Phase 3.1 & Phase 2.6.5 Hotfix Verify

実装作業が完了しました。以下の手順で動作確認をお願いします。

## 1. 起動手順
ターミナルで以下を実行し、ブラウザで `http://localhost:5173` を開いてください。
```bash
npm run dev
```

## 2. 動作確認項目 (UAC Verification)

### ✅ Scene 1 (Setup) -> Scene 2 (Gate)
1.  適当な参加者（名前、脚質）を入力し、フェーズを「序盤」「ペース」「終盤」等に設定して「エントリー確定」を押す。
2.  Scene 2 に遷移することを確認。

### ✅ Scene 2 (Gate) -> Scene 1 (Setup) Backtracking
1.  Scene 2 左上の「戻る」ボタンを押す。
2.  Scene 1 に戻り、**先ほど入力した内容が消えずに残っていること**を確認する。
3.  名前を修正し、再度「エントリー確定」を押す。

### ✅ Scene 2 (Gate) Persistence & Navigation
1.  Scene 2 で適当なダイス結果を貼り付け、解析して「枠順確定」状態にする。
2.  「枠順を確定してレース開始」を押して Scene 3 へ進む。
3.  Scene 3 左上の「戻る」ボタンを押す。
4.  Scene 2 に戻り、**確定済みの枠順リストが表示されていること**を確認する（「再解析」が不要な状態）。

### ✅ Scene 3 (Race) Validation & Scroll
1.  Scene 3 (序盤) で、入力エリアに何も入れずに「次のフェーズへ」を押す。
    *   **期待動作**: エラーメッセージ「序盤の結果が集計されていません...」が表示され、進めない。
2.  適当なダイスログ（または `dummy` 等）を貼り付けて「解析実行」する。
3.  画面を一番下までスクロールしてから「次のフェーズへ」を押す。
4.  **期待動作**: 次のフェーズに遷移した瞬間、画面が最上部へ自動スクロールする。

## 3. 重要修正 (StandardParser Fix)
Phase 2.6.5 (大逃げ) 対応時に発生していた「チェックサム検証ロジックの不備（カッコ内の数値を過信してしまう問題）」を修正しました。
*   通常計算: `30+dice=15 (45)` -> 正しく検証されます。
*   大逃げ: `-dice=15 (15)` -> **減算結果**として正しく処理されます。

## 4. Feedback Fix Verification (Scene 3 -> 2 Correction)
### ✅ Scene 3 (Race) Navigation
1.  Scene 3 (序盤) 左上に「**< 内容修正へ**」というボタンが表示されていることを確認。
    *   以前の「戻る」より明確な文言になっていること。
2.  右上の「やり直す」ボタンが薄いグレー（目立たないスタイル）になっていることを確認。
3.  「内容修正へ」を押すと、Scene 2 (枠順抽選) に戻ることを確認。
4.  Scene 2 から再度 Scene 3 に進んでも、データが保持されていることを確認。

### ✅ Partial Correction Flow (Selective Re-roll)
1.  **事前準備:** Scene 3 (序盤) まで進め、全員分のダイス結果を確定させる（Nextボタンが押せる状態）。
2.  **設定変更:** Scene 2 -> Scene 1 へ戻り、任意のウマ娘の**脚質**を変更する（例: 逃げ -> 差し）。
3.  **状態確認:** Scene 3 (序盤) に戻る。
    *   **PhaseOutput (上部):** 「未完了/要修正: 1」のようなバッジが表示されていることを確認。
    *   **PhaseInput (下部):** 以前の入力内容は残っている。
4.  **バリデーション動作:** 何もせずに「次のフェーズへ」を押す。
    *   **期待動作**: エラー「設定変更によりダイス形式が不一致...」が表示され、進めない。
5.  **修正手順 (Granular Check):**
    *   PhaseOutput の「修正分のみ表示」ボタンを押す。
    *   **期待動作**: **変更が必要な行のみ**（基礎ダイスまたは固有ダイス）が表示されることを確認。
        *   脚質のみ変更 -> 基礎ダイス行のみ表示
        *   固有タイプのみ変更 -> 固有ダイス行のみ表示
    *   表示されたテンプレートをコピーし、ダイスを振る。
    *   PhaseInput に、**そのウマ娘の新しい結果のみ**を貼り付けて「解析実行」する。
6.  **完了確認:**
    *   PhaseOutput のバッジが消える（または「要修正: 0」になる）。
    *   「次のフェーズへ」が押せるようになる。
    *   大逃げ（マイナスダイス）の場合でも、正しい結果であればバッジが表示されないことを確認。

### ✅ Navigation Fixes
1.  **Result (Scene 4) -> End Phase (Scene 3)**:
    *   Result画面の「戻る」を押し、直前のレースフェーズ（終盤）に戻ることを確認。
    *   エラー「phase_endの結果が集計されていません」が出ないことを確認。
2.  **No Judgment Back**:
    *   判定（写真・着差）が発生しないレースで Result画面から「戻る」を押すと、Judgment画面を経由せず直接レース画面に戻ることを確認。

### ✅ Error Handling (Auto Scroll)
1.  Scene 3 (序盤) で、入力エリアに何も入れずに、**画面を一番下までスクロールして「次のフェーズへ」を押す**。
2.  **期待動作**:
    *   エラーメッセージが表示される。
    *   **自動的に画面最上部（またはエラー表示位置）までスクロール**され、エラーメッセージが即座に視認できることを確認。

## User Feedback
(ここにフィードバックを記入してください)

- 変更が必要な行のみ表示 -> OK
- 大逃げ脚質の終盤ダイス処理 -> OK
- Scene 4からの戻り -> OK
  - 判定がない場合直接終盤へ戻る -> OK
- *追加* エラー発生時、**エラーメッセージの位置にスクロール**させたい
  - 特に画面最下部の「次のフェーズへ」が表示されている状態だとエラーメッセージが画面内に入らず、見えない