# 作業ログ: Setup Scene リファクタリング

## 基本情報
- **日付:** 2026-01-21
- **担当:** エンジニア (Antigravity)
- **対象:** `SetupScene`, `EntryForm`, `RaceConfigForm`, `useRaceStore`
- **目的:** 実装と要件定義書(`REQUIREMENTS.md`)の間の乖離を解消し、UXを改善する。

## 実施内容まとめ

### 1. 要件乖離の修正 (Refactoring)
- **レイアウト変更:**
    - 旧来の「トップダウン2カラム」構成を廃止し、`RaceConfigForm` → `EntryForm` の垂直フロー構成に変更。
    - 不要となった「開始前の確認」カードおよびシーン最下部の「レース開始」ボタンを削除。
- **エントリーリストの刷新:**
    - GUIをカード型グリッドから「HTMLテーブル」に変更し、一覧性を向上。
    - 各行に `#` (Entry Index), `名前`, `脚質`, `固有タイプ`, `発動位置` のカラムを配置。
    - リアルタイムバリデーション（赤枠表示）を実装。
- **レース設定機能の強化:**
    - `中盤ダイス回数` のスライダー実装（0～4回）。
    - `フルゲート人数` 設定と、それに基づく入力枠生成機（`generateParticipants`）の実装。

### 2. ロジック・検証機能の強化 (Logic & Validation)
- **厳格なバリデーション (Strict Validation):**
    - 必須項目（名前、脚質、固有タイプ、発動位置）の未入力を検知。
    - 禁止文字（`+`, `=`）のリアルタイムチェック。
    - エラーステータスがある場合、「エントリー確定」ボタンを無効化（Disabled）し、進行をブロックする安全設計を導入。
- **通知エリア (Notification Area):**
    - エントリーリスト下部にエラー内容を具体的にリストアップするコンポーネントを追加。
- **データ操作のUX改善:**
    - **非破壊的生成:** 「入力欄生成」時に、既存の入力済みデータを保持し、増減分のみを調整するロジックに変更。
    - **完全リセット:** 「Reset」時にエントリーだけでなく設定（フルゲート人数）も含めて初期化するよう修正。

### 3. UI/UX 改善 (Polishing)
- **テーマ対応:**
    - ダークモード（デフォルト）に加え、ライトモード配色を実装。
    - ヘッダーにテーマ切り替えスイッチを追加。
- **視認性向上:**
    - フルゲート人数入力欄の紛らわしいプレースホルダー（`18`）を削除。
    - テーブルヘッダーのSticky表示やスクロール対応。

## 残課題・申し送り事項 (Handover)
ユーザー確認において、Setup Sceneの機能は承認済み。ただし、本リファクタリングによりデータ構造や遷移ロジックが厳格化されたため、以降のシーン（Scene 2～）への接続確認と改修が必要となる可能性がある。

- **Scene 2 (枠順抽選) 以降の再構築:** 現在の実装はScene 1の改善に留まっており、後続シーンが新仕様のデータ（厳格化されたEntryデータ）を正しく扱えるか検証・修正が必要。
- **PMへの共有:** ユーザーより「現場修正よりPM工程での指示」を希望するフィードバックあり。微細なUX調整事項が残っている可能性があるため、次フェーズでの要件定義更新時に吸収を推奨。
